{% extends 'base.html' %}
{% block content %}
<!--
    Club Members management page.
    - Lists all members with edit/delete actions.
    - Includes modals for adding and editing members.
    - Navigation back to dashboard.
-->
<div class="main-container">
    <div class="members-header">
        <h2>Club Members</h2>
        <div class="members-header-actions">
            <button class="btn-secondary" type="button" id="resetFiltersBtn">
                <i class="fa-solid fa-rotate-left icon-left"></i>Reset Filters
            </button>
            <button class="btn-primary" id="addMemberBtn" type="button">
                <i class="fa-solid fa-user-plus icon-left"></i>Add Member
            </button>
        </div>
    </div>
    <div class="members-controls">
        <a href="{{ url_for('index') }}" class="btn-secondary">
            <i class="fa-solid fa-house icon-left"></i>
            Back to Dashboard
        </a>
        <div class="members-controls-spacer"></div>
        <div class="members-filters">
            <div class="filter-group">
                <label for="memberSearch" class="filter-label">Search</label>
                <input type="search" id="memberSearch" placeholder="Search by name or email">
            </div>
            <div class="filter-group rating-group">
                <label class="filter-label">Rating range</label>
                <div class="rating-inputs">
                    <input type="number" id="ratingMin" placeholder="Min" min="100" max="3000">
                    <span>â€“</span>
                    <input type="number" id="ratingMax" placeholder="Max" min="100" max="3000">
                </div>
            </div>
        </div>
    </div>
    <div class="members-table-wrapper">
        <table class="tournament-table members-table" id="membersTable">
            <thead>
                <tr>
                    <th data-sort-key="name">Name <i class="fa-solid fa-sort sort-indicator"></i></th>
                    <th data-sort-key="email">Email <i class="fa-solid fa-sort sort-indicator"></i></th>
                    <th data-sort-key="rating" class="numeric">Rating <i class="fa-solid fa-sort sort-indicator"></i>
                    </th>
                    <th data-sort-key="joined" class="numeric">Joined <i class="fa-solid fa-sort sort-indicator"></i>
                    </th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for member in members %}
                <tr data-member-id="{{ member['id'] }}" data-member-name="{{ member['name'] }}"
                    data-member-email="{{ member['email'] or '' }}" data-member-rating="{{ member['rating'] }}"
                    data-member-joined="{{ member['joined_at'][:10] }}">
                    <td class="cell-name">{{ member['name'] }}</td>
                    <td class="cell-email">{{ member['email'] or '-' }}</td>
                    <td class="cell-rating">{{ member['rating'] }}</td>
                    <td class="cell-joined">{% set dt = member['joined_at'] %}{{ dt[:10].split('-')[2] }}-{{
                        dt[:10].split('-')[1] }}-{{ dt[:10].split('-')[0] }}</td>
                    <td class="cell-actions">
                        <button type="button" class="btn-table btn-edit"><i
                                class="fa-solid fa-pen"></i></button>
                        <form method="post" action="{{ url_for('delete_member', member_id=member['id']) }}"
                            class="inline-form">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button type="submit" class="btn-table btn-delete"
                                onclick="return confirm('Delete this member?');"><i
                                    class="fa-solid fa-trash"></i></button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="members-empty-state" id="membersEmptyState">
            <i class="fa-solid fa-users-slash"></i>
            <p>No members match the current filters.</p>
        </div>
    </div>
</div>
<!-- Add Member Modal -->
<div id="addMemberModal" class="modal modal-hide">
    <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2>Add New Member</h2><br>
        <form method="post" action="{{ url_for('add_member') }}" class="add-member-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <label for="new-name" class="fw-500">Name</label>
            <input type="text" name="name" id="new-name" required>
            <label for="new-email" class="fw-500">Email</label>
            <input type="email" name="email" id="new-email">
            <label for="new-rating" class="fw-500">Rating</label>
            <input type="number" name="rating" id="new-rating" min="100" max="3000" value="1200">
            <button type="submit" class="btn-primary mt-1rem">Add Member</button>
        </form>
    </div>
</div>
<!-- Edit Member Modal -->
<div id="editMemberModal" class="modal modal-hide">
    <div class="modal-content">
        <span class="close" id="closeEditModal">&times;</span>
        <h2>Edit Member</h2><br>
        <form method="post" id="editMemberForm" class="add-member-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <label for="edit-name">Name</label>
            <input type="text" name="name" id="edit-name" required>
            <label for="edit-email">Email</label>
            <input type="email" name="email" id="edit-email">
            <label for="edit-rating">Rating</label>
            <input type="number" name="rating" id="edit-rating" min="100" max="3000">
            <button type="submit" class="btn-primary mt-1rem">Save Changes</button>
        </form>
    </div>
</div>
<!-- Scripts for modal logic -->
{% block scripts %}
<script src="{{ url_for('static', filename='js/addMemberModal.js') }}"></script>
<script src="{{ url_for('static', filename='js/manageMembersEnhancements.js') }}"></script>
{% endblock %}
{% endblock %}
